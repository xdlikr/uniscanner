graph TD
    User[ğŸ‘¤ ä½ ï¼ˆç³»ç»Ÿç®¡ç†å‘˜ / ç ”ç©¶å‘˜ï¼‰]

    subgraph G[ğŸ§¾ å®ªæ³• & æ²»ç†å±‚ Constitution & Governance]
        CONST[Constitution.yaml<br/>ç³»ç»Ÿæœ€é«˜è§„åˆ™]
        ModeManager[Mode Manager<br/>æ¨¡å¼ç®¡ç† SIM/DRY_RUN/LIVE]
    end

    subgraph D[ğŸ“¥ æ•°æ®å±‚ Data Layer]
        Ingestion[Data Ingestion<br/>è¡Œæƒ…/è´¢æŠ¥/æ–°é—»/å®è§‚æŠ“å–]
        Cleaning[Data Cleaning<br/>ç¼ºå¤±å€¼/æ—¶é—´æˆ³/å»é‡]
        Storage[Data Storage<br/>DB+å¯¹è±¡å­˜å‚¨+ç‰ˆæœ¬]
    end

    subgraph LLM[ğŸ§  LLM åˆ†æå±‚ LLM Agent Layer]
        EarningsAgent[Earnings Agent<br/>è´¢æŠ¥/ç”µè¯ä¼šè®®åˆ†æ]
        NewsAgent[News Agent<br/>æ–°é—»/äº‹ä»¶åˆ†æ]
        IndustryAgent[Industry Agent<br/>è¡Œä¸š/ç«å“å¯¹æ¯”]
        MacroAgent[Macro Agent<br/>å®è§‚ç¯å¢ƒåˆ†æ]
        ExplainAgent[Explain Agent<br/>å†³ç­–è§£é‡Š/æ€»ç»“]
    end

    subgraph DEC[âš–ï¸ å†³ç­–ä¸è¯„åˆ†å±‚ Scoring & Decision Engine]
        ScoringEngine[Scoring Engine<br/>ç»¼åˆå¾—åˆ†/è¯„çº§]
        SignalGenerator[Signal Generator<br/>Buy/Hold/Sell ä¿¡å·]
    end

    subgraph RISK[ğŸ›¡ï¸ é£é™©æ§åˆ¶å±‚ Risk & Portfolio]
        PortfolioBuilder[Portfolio Builder<br/>ç›®æ ‡ä»“ä½è®¡ç®—]
        RiskManager[Risk Manager<br/>ä»“ä½/è¡Œä¸š/å›æ’¤çº¦æŸ]
    end

    subgraph EXEC[ğŸ’¼ æ‰§è¡Œå±‚ Execution Layer]
        OrderGenerator[Order Generator<br/>è®¢å•ç”Ÿæˆ]
        BrokerAPI[Broker API Adapter<br/>åˆ¸å•†é€‚é…]
    end

    subgraph MON[ğŸ“Š ç›‘æ§ & å®¡è®¡å±‚ Monitoring & Audit]
        Monitor[Realtime Monitor<br/>æ”¶ç›Š/é£é™©ç›‘æ§]
        Alert[Alert System<br/>å‘Šè­¦/é€šçŸ¥]
        AuditLog[Audit Logger<br/>å®Œæ•´å®¡è®¡æ—¥å¿—]
    end

    User --> CONST
    User --> ModeManager
    ModeManager -->|é™åˆ¶/é…ç½®| Ingestion
    ModeManager --> LLM
    ModeManager --> DEC
    ModeManager --> RISK
    ModeManager --> EXEC

    CONST --> ModeManager
    CONST --> RiskManager
    CONST --> EXEC
    CONST --> Monitor

    Ingestion --> Cleaning --> Storage

    Storage --> EarningsAgent
    Storage --> NewsAgent
    Storage --> IndustryAgent
    Storage --> MacroAgent

    EarningsAgent --> ScoringEngine
    NewsAgent --> ScoringEngine
    IndustryAgent --> ScoringEngine
    MacroAgent --> ScoringEngine

    ScoringEngine --> SignalGenerator
    SignalGenerator --> PortfolioBuilder
    PortfolioBuilder --> RiskManager
    RiskManager --> OrderGenerator
    OrderGenerator --> BrokerAPI

    BrokerAPI --> AuditLog
    RiskManager --> AuditLog
    ScoringEngine --> AuditLog
    LLM --> AuditLog

    Monitor --> User
    Alert --> User