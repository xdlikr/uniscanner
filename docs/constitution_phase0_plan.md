# 宪法与治理系统 - 核心痛点解决方案（实施计划）

## 🎯 只解决真正痛点

### 核心痛点识别
1. **系统可能因配置错误而崩溃** → 宪法验证  
2. **风险控制失效导致重大损失** → 严格模式管理  
3. **问题无法追溯和调试** → 基础日志系统  
4. **测试覆盖不足导致生产事故** → 关键路径测试  

---

## 📋 最小可行实施计划（只保留需要做什么）

---

## Phase 0：生存必需功能（MVP）

---

### **Task 0.1 — 宪法数据结构 (生存必需)**  
**需要做：**  
- 定义风险参数数据结构  
- 定义模式权限结构  
- 定义紧急规则结构  
- 输出文件：`src/constitution/schema.py`

---

### **Task 0.2 — 宪法加载器 (生存必需)**  
**需要做：**  
- 基础 YAML 加载  
- 类型校验  
- 暴露统一访问 API (`get_risk_limits()` 等)  
- 输出文件：`src/constitution/loader.py`

---

### **Task 0.3 — 宪法验证器 (风险控制必需)**  
**需要做：**  
- 数值范围校验  
- 业务逻辑校验（如杠杆一致性）  
- 必填字段校验  
- 输出文件：`src/constitution/validator.py`

---

### **Task 0.4 — 模式管理器 (风险控制必需)**  
**需要做：**  
- 三态状态机：`SIM ↔ DRY_RUN ↔ LIVE`  
- 模式切换日志记录  
- LIVE 模式需人工确认  
- 输出文件：`src/app/mode_manager.py`

---

### **Task 0.5 — 配置分离 (运维必需)**  
**需要做：**  
- 分离宪法与运行配置  
- 运行环境基础配置加载  
- 输出文件：`src/config/loader.py`

---

### **Task 0.6 — 基础日志系统 (调试必需)**  
**需要做：**  
- 结构化日志  
- 核心操作审计记录  
- 错误堆栈捕获  
- 输出文件：`src/app/logging_setup.py`

---

### **Task 0.7 — 关键路径测试 (质量必需)**  
**需要做：**  
- 宪法加载器正常/异常测试  
- 模式管理器状态切换测试  
- 宪法验证器边界测试  
- 输出文件：`tests/` 目录基础测试文件

---

## 🚀 实施优先级（从“没有会死”开始）

### 第一优先级（系统能启动）
- Task 0.1  
- Task 0.2  
- Task 0.6  

### 第二优先级（风险可控）
- Task 0.4  
- Task 0.3  

### 第三优先级（运维可用）
- Task 0.5  
- Task 0.7  

---

## ⚠️ 明确不做（非痛点，后续迭代）

- 宪法热重载  
- 版本管理与回滚  
- 配置继承体系  
- 自动化部署  
- 性能监控  

---

## 📊 成功标准

系统必须做到：  
- 安全加载宪法  
- 在错误配置时清晰报错  
- 所有模式切换可审计  
- 防止误进入 LIVE 实盘模式  
- 基础测试覆盖关键路径  

---

*专注“没有会死”的功能，确保系统最小安全可运行。*
